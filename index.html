<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Todos</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.0/redux.min.js"></script>
  <script src="https://unpkg.com/react/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone/babel.min.js"></script>
  <script src="https://tylermcginnis.com/goals-todos-api/index.js"></script>
  <script src="https://unpkg.com/redux-thunk/dist/redux-thunk.min.js"></script>
</head>
<body>

  <div id="app"></div>

  <script src="./index.js"></script>
  <script type="text/babel">
    const List = props => (
      <ul>
        {props.items.map(item =>
          <li key={item.id}>
            <span
              onClick={() => props.toggle && props.toggle(item.id)}
              style={{textDecoration: item.complete ? 'line-through' : 'none'}}
            >
              {item.name}
            </span>
            <button onClick={() => props.remove(item)}>X</button>
          </li>
        )}
      </ul>
    );

    class Todos extends React.Component {

      addItem = e => {
        e.preventDefault();
        // Add a todo item to list
        const name = this.input.value;
        this.props.store.dispatch(handleAddTodo(
          name,
          () => this.input.value = '',
          () => this.input.value = name
        ));
      }

      removeItem = todo => {
        // Remove a todo item from list
        this.props.store.dispatch(handleRemoveTodo(todo));
      }

      toggleItem = id => {
        // Toggle a todo item's completion status
        this.props.store.dispatch(handleToggleTodo(id));
      }

      render() {
        return (
          <div>
            <h1>Todo List</h1>
            <input
              type="text"
              placeholder="Add todo"
              ref={input => this.input = input}
            />
            <button onClick={this.addItem}>Add Todo</button>

            <List items={this.props.todos} toggle={this.toggleItem} remove={this.removeItem} />
          </div>
        );
      }
    }

    class Goals extends React.Component {

      addItem = e => {
        e.preventDefault();
        // Add a goal to list
        const name = this.input.value;
        this.props.store.dispatch(handleAddGoal(
          name,
          () => this.input.value = '',
          () => this.input.value = name
        ));
      }

      removeItem = goal => {
        // Remove a goal from list
        this.props.store.dispatch(handleRemoveGoal(goal));
      }

      render() {
        return (
          <div>
            <h1>Goals</h1>
            <input
              type="text"
              placeholder="Add goal"
              ref={input => this.input = input}
            />
            <button onClick={this.addItem}>Add Goal</button>

            <List items={this.props.goals} remove={this.removeItem} />
          </div>
        );
      }
    }

    class App extends React.Component {

      async componentDidMount() {
        // Receive initial data from server
        this.props.store.subscribe(() => this.forceUpdate());
        this.props.store.dispatch(handleReceiveData());
      }

      render() {
        const { todos, goals, loading } = this.props.store.getState();

        // If data have not yet been received from server, render a loading indicator; else render the UI
        return loading ? <h3>Loading...</h3> : (
          <div>
            <Todos store={this.props.store} todos={todos} />
            <Goals store={this.props.store} goals={goals} />
          </div>
        );
      }
    }

    ReactDOM.render(<App store={store} />, document.getElementById('app'));
  </script>
</body>
</html>
